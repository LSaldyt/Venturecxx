FROM            ubuntu:16.04
MAINTAINER      MIT Probabilistic Computing Project

RUN             apt-get update -qq
RUN             apt-get upgrade -qq

RUN             apt-get install -qq build-essential
RUN             apt-get install -qq ccache
RUN             apt-get install -qq git
RUN             apt-get install -qq libboost-all-dev
RUN             apt-get install -qq libgsl0-dev
RUN             apt-get install -qq python-flask
RUN             apt-get install -qq python-matplotlib
RUN             apt-get install -qq python-nose
RUN             apt-get install -qq python-nose-testconfig
RUN             apt-get install -qq python-numpy
RUN             apt-get install -qq python-pandas
RUN             apt-get install -qq python-pexpect
RUN             apt-get install -qq python-requests
RUN             apt-get install -qq python-scipy

RUN             mkdir -p ~/.config/matplotlib
RUN             echo 'backend: agg' > ~/.config/matplotlib/matplotlibrc

ADD             . /Venturecxx
WORKDIR         /Venturecxx

# Provisional kludge to disable nose-cov business, which is not in
# Ubuntu 16.04.
RUN             for x in *.cfg; do \
                  sed -e 's,^\([^#].*\)\?cov,#&,g' < "$x" > "$x".tmp && \
                  mv -f "$x".tmp "$x"; \
                done
RUN             grep -H cov *.cfg

RUN             ./check.sh
RUN             python setup.py sdist
RUN             python setup.py bdist
